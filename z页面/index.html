<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/1.css">
</head>

<body>
    <div id="outer">
        <header>
            <div id="header-top">
                <div id="header-top-con">
                    <span>尚品汇欢迎您 &nbsp;&nbsp;请</span>
                    <ul id="login">
                        <li><a href="###"><span class="right-border">登录</span></a></li>
                        <li><a href="###"><span>免费注册</span></a></li>
                    </ul>
                    <ul id="header-menu">
                        <li><a href="###" class="clearleftborder"> 我的订单</a></li>
                        <li><a href="###">我的购物车</a></li>
                        <li><a href="###">我的尚品汇</a></li>
                        <li><a href="###">尚品汇会员</a></li>
                        <li><a href="###">企业采购</a></li>
                        <li><a href="###">关注尚品汇</a></li>
                        <li><a href="###">合作招聘</a></li>
                        <li><a href="###">商家后台</a></li>
                    </ul>
                </div>
            </div>
            <div id="header-btm">
                <div id="header-btm-con">
                    <img src="./images/Logo.png" alt="">
                    <div id="search">
                        <input type="text">
                        <button value="">搜索</button>
                    </div>
                </div>
            </div>
        </header>
        <nav id="allnav">
            <div id="nav-con">
                <h2><a href="###">所有商品分类</a></h2>
                <ul id="nav-list">
                    <li><a href="###">服装城</a></li>
                    <li><a href="###">美妆馆</a></li>
                    <li><a href="###">尚品汇超市</a></li>
                    <li><a href="###">全球购</a></li>
                    <li><a href="###">闪购</a></li>
                    <li><a href="###">团购</a></li>
                    <li><a href="###">有趣</a></li>
                    <li><a href="###">秒杀</a></li>
                </ul>
            </div>
        </nav>

        <div id="content">
            <div id="route">
                <p>
                    <a href="###">手机、数码、通讯手机</a>
                    <span>/</span>
                    <a href="###">Apple苹果</a>
                    <span>/</span>
                    <a href="###">iphone 6S类</a>
                </p>
            </div>

            <div id="item-display">
                <div id="item-preview">
                    <div id="smallArea">
                        <img src="./images/s1.png" alt="">
                        <div id="mask"></div>
                    </div>
                    <div id="bigArea">
                        <img src="./images/b1.png" alt="">

                    </div>
                    <div id="image-select">
                        <button id="left">&lt;</button>
                        <div id="thumbnail-display">
                            <ul id="thumbnail-list">
                                <!-- <img src="./images/s1.png" alt="">
                                <img src="./images/s2.png" alt="">
                                <img src="./images/s3.png" alt="">
                                <img src="./images/s1.png" alt="">
                                <img src="./images/s2.png" alt=""> -->
                            </ul>
                        </div>
                        <button id="right">&gt;</button>
                    </div>
                </div>
                <div id="item-info">
                    <h3>Apple iPhone 6s（A1700）64G玫瑰金色 移动通信电信4G手机</h3>
                    <p id="ad">推荐选择下方[移动优惠购],手机套餐齐搞定,不用换号,每月还有花费返</p>
                    <div id="price-main">
                        <p><span>价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</span> <span id="price">¥<em>5000</em>元</span>
                        </p>
                        <p><span>促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</span> <span
                                id="jiajiagou">加价购</span><span>满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</span>
                        </p>
                    </div>
                    <p><span>支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</span><span>以旧换新，闲置手机回收 4G套餐超值抢 礼品购</span></p>
                    <p><span>配 送 至</span><span>广东省 深圳市 宝安区</span></p>
                    <div id="choose-insert"></div>
                    <div id="selected-label">

                    </div>
                    <div id="select-area">
                        <!-- <div class="select-unit"><span>选择颜色</span>
                            <ul class="buy-select">
                                <li class="active">金色</li>
                                <li>银色</li>
                                <li>黑色</li>
                            </ul>
                        </div>
                        <div class="select-unit"><span>内存容量</span>
                            <ul class="buy-select">
                                <li class="active">16G</li>
                                <li>32G</li>
                                <li>64G</li>
                                <li>128G</li>
                            </ul>
                        </div>
                        <div class="select-unit"><span>选择版本</span>
                            <ul class="buy-select">
                                <li class="active">公开版</li>
                                <li>移动版</li>
                            </ul>
                        </div>
                        <div class="select-unit"><span>选择优惠</span>
                            <ul class="buy-select">
                                <li class="active">官方标配</li>
                                <li>移动优惠版</li>
                                <li>电信优惠版</li>
                            </ul>
                        </div> -->
                    </div>
                    <div id="item-count">
                        <input type="text" value="1">
                        <button id="increase">+</button>
                        <button id="decrease">-</button>
                        <button id="addtochar">加入购物车</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="product-detail">
            <div id="aside">
                <div id="tag-switch">
                    <div id="tag-head">
                        <div class="active">相关分类</div>
                        <div>推荐品牌</div>
                    </div>
                    <div class="tag-body">
                        <div class="con active">
                            <ul id="tag-list">
                                <li><a href="###">手机</a></li>
                                <li><a href="###">手机壳</a></li>
                                <li><a href="###">内存卡</a></li>
                                <li><a href="###">iPhone配件</a></li>
                                <li><a href="###">贴膜</a></li>
                                <li><a href="###">手机耳机</a></li>
                                <li><a href="###">移动电源</a></li>
                                <li><a href="###">平板电脑</a></li>
                            </ul>
                            <div id="relative-item">
                                <img src="./images/part01.png" alt="">
                                <p>Apple苹果iPhone 6s (A1699)</p>
                                <p id="item-price">¥6088.00</p>
                                <button>加入购物车</button>
                            </div>
                            <div id="relative-item">
                                <img src="./images/part01.png" alt="">
                                <p>Apple苹果iPhone 6s (A1699)</p>
                                <p id="item-price">¥6088.00</p>
                                <button>加入购物车</button>
                            </div>
                            <div id="relative-item">
                                <img src="./images/part01.png" alt="">
                                <p>Apple苹果iPhone 6s (A1699)</p>
                                <p id="item-price">¥6088.00</p>
                                <button>加入购物车</button>
                            </div>
                            <div id="relative-item">
                                <img src="./images/part01.png" alt="">
                                <p>Apple苹果iPhone 6s (A1699)</p>
                                <p id="item-price">¥6088.00</p>
                                <button>加入购物车</button>
                            </div>
                        </div>
                        <div class="con">
                            <ul id="tag-list">
                                <li><a href="###">手机</a></li>
                                <li><a href="###">手机壳</a></li>
                                <li><a href="###">内存卡</a></li>
                                <li><a href="###">iPhone配件</a></li>
                                <li><a href="###">贴膜</a></li>
                                <li><a href="###">手机耳机</a></li>
                                <li><a href="###">移动电源</a></li>
                                <li><a href="###">平板电脑</a></li>
                            </ul>

                        </div>
                    </div>
                </div>


            </div>
            <div id="detail">
                <div id="fitting">
                    <div id="fitting-title">
                        选择搭配
                    </div>
                    <div id="companion">
                        <div class="companion-item">
                            <img src="./images/itemlike06.png" alt="">
                            <p class="red-price">¥5299</p>
                        </div>
                        <span id="plus">+</span>
                        <div class="companion-item">
                            <img src="./images/dp01.png" alt="">
                            <p>Feless费勒斯VR</p>
                            <input type="checkbox">
                            <span>39</span>

                        </div>
                        <div class="companion-item">
                            <img src="./images/dp02.png" alt="">
                            <p>Feless费勒斯VR</p>
                            <input type="checkbox">
                            <span>50</span>
                        </div>
                        <div class="companion-item">
                            <img src="./images/dp03.png" alt="">
                            <p>
                                <p>Feless费勒斯VR</p>
                                <input type="checkbox">
                                <span>59</span>
                        </div>
                        <div class="companion-item">
                            <p><img src="./images/dp04.png" alt=""></p>
                            <p>
                                <p>Feless费勒斯VR</p>
                            </p>
                            <input type="checkbox">
                            <span>99</span>
                        </div>
                        <div id="addToChart">
                            <p>已选购<span id="count">0</span>件物品</p>
                            <p class="jiacu">套餐价</p>
                            <p class="red-price">¥5299</p>
                            <button id="addtochar1">加入购物车</button>
                        </div>
                    </div>
                </div>
                <div id="detail-show">
                    <div id="detail-tag-head">
                        <h2 class="active">商品介绍</h2>
                        <h2>规格与包装</h2>
                        <h2>售后保障</h2>
                        <h2>商品评价</h2>
                        <h2>手机社区</h2>
                    </div>
                    <div class="detail-tag-body active">
                        <div class="show">
                            <ul id="detail-intro">
                                <li>分辨率：1920*1080(FHD)</li>
                                <li>后置摄像头：1200万像素</li>
                                <li>前置摄像头：500万像素</li>
                                <li>核 数：其他</li>
                                <li>频 率：以官网信息为准</li>
                                <li>品牌： Apple</li>
                                <li>商品名称：APPLEiPhone 6s Plus</li>
                                <li>商品编号：1861098</li>
                                <li>商品产地：中国大陆</li>
                                <li>商品毛重：0.51kg</li>
                                <li>热点：指纹识别，Apple Pay，金属机身，拍照神器</li>
                                <li>系统：苹果（IOS）</li>
                                <li>像素：1000-1600万品毛重：0.51kg</li>
                                <li>机身内存：64GB</li>
                            </ul>
                            <img src="./images/intro01.png" alt="">
                            <img src="./images/intro02.png" alt="">
                            <img src="./images/intro03.png" alt="">
                        </div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                    <div class="detail-tag-body "></div>
                    <div class="detail-tag-body "></div>
                    <div class="detail-tag-body "></div>
                    <div class="detail-tag-body "></div>
                </div>
            </div>
        </div>

        <div id="sidebar">
            <div class="menu"></div>
            <ul class="naviList">
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
            </ul>
            <div class="backToTop"></div>
        </div>
    </div>
    <script src="./js/data.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", function () {
            //效果1 放大镜
            magnifier()

            function magnifier() {

                var oSmallArea = document.getElementById("smallArea");
                var oMask = document.getElementById("mask")
                var oBigArea = document.getElementById("bigArea")
                var oBigImg = document.querySelector("#bigArea img")
                oSmallArea.onmousemove = function (e) {
                    oMask.style.display = "block";
                    oBigArea.style.display = "block";
                    var oMaskLocation = {
                        left: e.clientX - oSmallArea.getBoundingClientRect().left - oMask.offsetWidth /
                            2,
                        top: e.clientY - oSmallArea.getBoundingClientRect().top - oMask.offsetWidth / 2
                    }
                    if (oMaskLocation.left < 0) {
                        oMaskLocation.left = 0;
                    } else if (oMaskLocation.left >= oSmallArea.clientWidth - oMask.offsetWidth) {
                        oMaskLocation.left = oSmallArea.clientWidth - oMask.offsetWidth;
                    }
                    if (oMaskLocation.top < 0) {
                        oMaskLocation.top = 0;
                    } else if (oMaskLocation.top >= oSmallArea.clientHeight - oMask.offsetWidth) {
                        oMaskLocation.top = oSmallArea.clientHeight - oMask.offsetHeight;
                    }
                    oMask.style.top = oMaskLocation.top + "px";
                    oMask.style.left = oMaskLocation.left + "px";

                    //控制大图的比例计算
                    //蒙版走的距离oMaskLocation / 蒙版最大移动距离 = 大图移动的距离 / 大图能够移动的距离
                    //大图移动的距离 = 蒙版走的距离oMaskLocation * 大图能够移动的距离 / 蒙版最大移动距离
                    //转换： 大图移动的距离= 蒙版走的距离oMaskLocation * (大图能够移动的距离 / 蒙版最大移动距离)
                    //因为图形和蒙版都是正方形，所以不考虑两个方向，求出一个scale即可 scale = 大图能够移动的距离 / 蒙版最大移动距离
                    //大图能够移动的距离:
                    var oMaskAll = oSmallArea.clientTop - oMask.offsetWidth;
                    var oBigImgAll = oBigImg.clientWidth - oBigArea.offsetWidth;
                    var scale = oBigImgAll / oMaskAll;
                    var oBigImgLocation = {
                        left: oMaskLocation.left * scale,
                        top: oMaskLocation.top * scale,
                    }
                    oBigImg.style.top = oBigImgLocation.top + "px";
                    oBigImg.style.left = oBigImgLocation.left + "px";
                }
                oSmallArea.onmouseleave = function () {
                    oMask.style.display = "none";
                    oBigArea.style.display = "none";
                }
            }

            //效果2 动态生成缩略图
            thumbnailData();

            function thumbnailData() {
                var oList = document.querySelector("#thumbnail-list");
                var oFrag = document.createDocumentFragment();
                var imgData = goodData.imgsrc;
                imgData.forEach(function (item, index) {
                    var newLi = document.createElement("li");
                    var newImg = document.createElement("img");
                    newImg.src = item.s;
                    newLi.appendChild(newImg);
                    oFrag.appendChild(newLi);
                })
                oList.appendChild(oFrag);
            }


            //效果3 缩略图
            thumbnail()

            function thumbnail() {
                var oList = document.querySelector("#thumbnail-list");
                var oLis = document.querySelectorAll("#thumbnail-list li")
                var oLeft = document.querySelector("#left");
                var oRight = document.querySelector("#right");
                var oListLocation = 0;
                var oListAllMove = (oLis.length - 5) * oLis[0].offsetWidth;
                var everyMove = oLis[0].offsetWidth * 2
                oRight.onclick = function () {
                    if (oListAllMove - oListLocation < everyMove) {
                        oListLocation = oListAllMove;
                    } else {
                        oListLocation += everyMove;
                    }
                    oList.style.transform = "translateX(-" + oListLocation + "px)"
                }
                oLeft.onclick = function () {
                    if (oListLocation < everyMove) {
                        oListLocation = 0;
                    } else {
                        oListLocation -= everyMove;
                    }
                    oList.style.transform = "translateX(-" + oListLocation + "px)"
                }
            }

            //效果4 缩略图点击
            thumbnailClick()

            function thumbnailClick() {
                var imgData = goodData.imgsrc;
                var oSmallImg = document.querySelector("#smallArea img");
                var oBigImg = document.querySelector("#bigArea img")
                var oLis = document.querySelectorAll("#thumbnail-list img");

                oLis.forEach(function (item, index) {
                    item.onclick = function () {
                        oSmallImg.src = item.src;
                        oBigImg.src = imgData[index].b;
                    }
                })
            }



            //效果6 动态生成商品选项
            generateChoose();

            function generateChoose() {
                var oBox = document.querySelector("#select-area");
                var data = goodData.goodsDetail.crumbData;

                data.forEach(function (item, index) {
                    var oDl = document.createElement("dl");
                    var oDt = document.createElement("dt");
                    oDt.innerText = item.title;
                    oDl.appendChild(oDt);
                    item.data.forEach(function (item, index) {
                        var oDd = document.createElement("dd");
                        oDd.textContent = item.type;
                        oDd.dataset.price = item.changePrice;
                        oDl.appendChild(oDd);
                    })
                    oBox.appendChild(oDl);
                })
            }


            //效果5 选择选项跳出
            choooseLabel()

            function choooseLabel() {
                var oMarkCon = document.querySelector("#selected-label");
                var oDls = document.querySelectorAll("#select-area dl");
                var data = goodData.goodsDetail;
                var chooseArr = new Array(4);
                chooseArr.fill(null);
                oDls.forEach(function (item, index) {
                    var dlIndex = index;
                    //保存当前dl的下标
                    var oDds = item.querySelectorAll("dd");
                    oDds.forEach(function (item, index) {
                        item.onclick = function () {

                            oDds.forEach(function (item, index) {
                                item.classList.remove("active");
                            })
                            //点击后改变点击的样式为醒目样式
                            this.classList.add("active");
                            var ddThis = this;
                            //设置数组
                            chooseArr[dlIndex] = item;

                            //每次添加先清空mark容器内容
                            oMarkCon.textContent = "";
                            //点击后遍历数组，通过数组来添加mark
                            chooseArr.forEach(function (item, index) {
                                if (!item) {
                                    return;
                                }
                                var newMark = document.createElement("mark");
                                var oDele = document.createElement("a");
                                newMark.textContent = item.textContent;
                                oDele.textContent = "X";
                                /* oDele.onclick=function(){
                                    oDele.parentNode.remove();
                                    ddThis.classList.remove("active");
                                    
                                } */
                                //给删除按钮绑定一个自定义属性，保存的是当前mark对应的dl的下标
                                oDele.dataset.index = index;
                                newMark.appendChild(oDele);
                                oMarkCon.appendChild(newMark);
                            })

                            //删除功能
                            var oDeles = document.querySelectorAll("mark a");
                            oDeles.forEach(function (item, index) {
                                item.onclick = function () {
                                    this.parentNode.remove();;
                                    //删除数组里是数值
                                    chooseArr[this.dataset.index] = null;
                                    //删除之后清除所有的当前dl中的dd的颜色，然后给第一个添加
                                    //先获取当前删除元素的对应的dl的下标，然后获取里边所有dd
                                    var oNowDd = oDls[this.dataset.index]
                                        .querySelectorAll("dd");
                                    oNowDd.forEach(function (item, index) {
                                        item.classList.remove("active");
                                    })
                                    oNowDd[0].classList.add("active");

                                    //删除mark的时候也要修改价钱
                                    changePrice(chooseArr)
                                }


                            })
                            changePrice(chooseArr)
                        }
                    })
                })

                function changePrice(arr) {
                    var oPrice = document.querySelector("#price em");
                    var basePrice = data.price;
                    //点击选择的时候改变价钱
                    //遍历数组，得到里边dd要修改的价钱，然后在基础价钱上累加
                    arr.forEach(function (item, index) {
                        if (!item) {
                            return;
                        }
                        //item就是选择的dd取上面的价钱
                        basePrice += +item.dataset.price;
                    });
                    var oText = document.querySelector("#item-count input");
                    //价钱赋值
                    //乘数量
                    oPrice.textContent = basePrice * oText.value;
                }
            }

            //效果8 数量改变价钱也改变
            goodsNum();

            function goodsNum() {
                var oPlus = document.querySelector("#item-count #increase")
                var oMin = document.querySelector("#item-count #decrease");
                var oText = document.querySelector("#item-count input");
                var oPrice = document.querySelector("#price em");
                var sum = 1;

                oPlus.onclick = function () {
                    var nowPrice = +oPrice.textContent;
                    sum++;
                    oText.value = sum;

                    //根据数据计算总价 sum*单价
                    var allPrice = sum * (nowPrice / (sum - 1));
                    oPrice.textContent = allPrice;
                }
                oMin.onclick = function () {
                    var nowPrice = +oPrice.textContent;
                    sum--;
                    if (sum < 1) {
                        sum = 1;
                        return;
                    }
                    oText.value = sum;

                    //根据数据计算总价 sum*单价
                    var allPrice = sum * (nowPrice / (sum + 1));
                    oPrice.textContent = allPrice;
                }
            }

            //选项卡切换
            function Tab(oTitles, oCons) {
                this.oTitles = oTitles;
                this.oCons = oCons;
                var _this = this;
                this.oTitles.forEach(function (item, index) {
                    item.onclick = function () {
                        //把item也就是点击元素传参传到click方法中
                        _this.click(this, index);
                    }
                })
            }
            Tab.prototype.click = function (o, i) {
                //o就是执行click事件传入的绑定事件对象
                //i就是o对应的下标
                //先清空
                var _this = this;
                this.oTitles.forEach(function (item, index) {
                    item.classList.remove("active");
                    _this.oCons[index].classList.remove("active");
                })
                //给样式
                o.classList.add("active");
                this.oCons[i].classList.add("active");

            }

            //侧边栏Tab
            asideTab();
            function asideTab() {
                var oTitles = document.querySelectorAll("#tag-head div");
                var oCons = document.querySelectorAll(".tag-body .con");
                new Tab(oTitles, oCons);
            }
            //内容Tab
            conTab();
            function conTab(){
                var oTitles=document.querySelectorAll("#detail-tag-head h2");
                var oCons=document.querySelectorAll("#detail-show .detail-tag-body");
                new Tab(oTitles,oCons)
            }

            asideClick()
            function asideClick(){
                var oMenu=document.querySelector("#sidebar .menu");
                var oToolBar=document.querySelector("#sidebar");
                var flag=false;

                oMenu.onclick=function(){
                    if(flag){
                        oToolBar.style.right="-294px"
                    }else{
                        oToolBar.style.right="0"
                    }
                    flag=!flag
                }
            }
        })
    </script>
</body>

</html>